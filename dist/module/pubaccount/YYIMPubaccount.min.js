YYIMChat=function(t){var e=t.constructor,o=function(){function e(e){var o=new JumpPacket({type:t.getConstants().TYPE.GET,ns:NS_PUBACCOUNT,to:t.getConfig().DOMAIN.PUBACCOUNT},OPCODE.PUBACCOUNT_LIST.SEND);t.getConnection().send(o,function(e,o){if(o){o.complete&&o.complete();for(var n=e.items||[],c=n.length||0;c--;)n[c].id=t.getJIDUtil().getID(n[c].jid);o.success&&o.success(JSON.stringify(n))}},e)}function o(e){jQuery.ajax({url:t.getConfig().SERVLET.REST_USER_SERVLET+t.getConfig().MULTI_TENANCY.ETP_KEY+"/"+t.getConfig().MULTI_TENANCY.APP_KEY+"/pubaccount/"+t.getUserID()+"/items",dataType:"json",data:{token:t.getToken(),pubIds:JSON.stringify(e.pubIds)},cache:!1,success:function(o){o=o||[];for(var n=o.length||0;n--;)o[n].id=t.getJIDUtil().getID(o[n].jid);e.success&&e.success(o),e=null},error:function(t){try{e.error&&e.error(JSON.parse(t.responseText)),e=null}catch(t){e.error&&e.error(),e=null}}})}function n(e){jQuery.ajax({url:t.getConfig().SERVLET.REST_USER_SERVLET+t.getConfig().MULTI_TENANCY.ETP_KEY+"/"+t.getConfig().MULTI_TENANCY.APP_KEY+"/"+e.id+"/"+t.getUserID()+"/pubaccount/info",dataType:"json",data:{token:t.getToken()},cache:!1,success:function(o){o&&o.data&&(o.data.id=t.getJIDUtil().getID(o.data.jid),e.success&&e.success(o.data),e=null)},error:function(t){try{e.error&&e.error(JSON.parse(t.responseText)),e=null}catch(t){e.error&&e.error(),e=null}}})}function c(e){var o={start:YYIMCommonUtil.isNumber(e.start)?e.start:0,size:YYIMCommonUtil.isNumber(e.size)?e.size:20,fields:["Accountname","Name"],search:e.keyword};t.getConnection().send(new JumpPacket(o,OPCODE.QUERY_PUBACCOUNT.SEND),function(e,o){for(var n=e.items||[],c=[],r=n.length;r--;){var u=n[r],i=u.jid;c.push({id:t.getJIDUtil().getID(i),name:YYIMCommonUtil.isStringAndNotEmpty(u.name)?u.name:t.getJIDUtil().getID(i),type:u.type})}o.complete&&o.complete(),o.success&&o.success({start:e.start,total:e.total,items:c})},e)}function r(e){t.getConnection().send(new JumpPacket({type:t.getConstants().PRESENCE_TYPE.SUBSCRIBE,to:e.jid},OPCODE.PRESENCE.SEND),function(e,o){o.complete&&o.complete(),e.from=t.getJIDUtil().getID(e.from),e.to=t.getJIDUtil().getID(e.to),o.success&&o.success(e)},e)}function u(e){t.getConnection().send(new JumpPacket({id:e.id,type:t.getConstants().PRESENCE_TYPE.UNSUBSCRIBE,to:e.to},OPCODE.PRESENCE.SEND),function(e,o){o.complete&&o.complete(),e.from=t.getJIDUtil().getID(e.from),e.to=t.getJIDUtil().getID(e.to)||t.getUserID(),o.success&&o.success(e)},e)}function i(){t.getConnection().registerHandler(OPCODE.PUBACCOUNT_LIST.KEY,function(e){var o=e.items;if(0!==(o&&o.length||0)){for(var n=[],c=o.length;c--;){var r=o[c];r.id=t.getJIDUtil().getID(r.jid),n.push(r)}t.onPubaccountUpdate(n)}})}return{monitor:i,addPubAccount:r,getPubAccounts:o,getPubAccountItems:e,getPubAccountInfo:n,removePubAccount:u,queryPubaccount:c}}();return t.setBackhander({monitor:{pubaccountMonitor:o.monitor},initCallback:{pubaccount:function(e){t.onPubaccountUpdate=e.onPubaccountUpdate||function(){}}}}),e.prototype.getPubAccount=function(t){o.getPubAccountItems(t)},e.prototype.getPubAccounts=function(t){YYIMUtil.isWhateType(t.pubIds,"Array")?o.getPubAccounts(t):t&&t.error&&t.error()},e.prototype.getPubAccountInfo=function(t){YYIMCommonUtil.isStringAndNotEmpty(t.id)?o.getPubAccountInfo(t):t&&t.error&&t.error()},e.prototype.addPubaccount=function(e){YYIMCommonUtil.isStringAndNotEmpty(e.id)?o.addPubAccount({jid:t.getJIDUtil().buildPubAccountJID(t.getJIDUtil().getNode(e.id)),success:e.success,error:e.error}):e&&e.error&&e.error()},e.prototype.removePubaccount=function(e){YYIMCommonUtil.isStringAndNotEmpty(e.id)?o.removePubAccount({id:Math.uuid(),to:t.getJIDUtil().buildPubAccountJID(t.getJIDUtil().getNode(e.id)),success:e.success,error:e.error}):e&&e.error&&e.error()},e.prototype.queryPubaccount=function(t){YYIMCommonUtil.isStringAndNotEmpty(t.keyword)?o.queryPubaccount(t):t&&t.error&&t.error()},e.getInstance()}(YYIMChat);