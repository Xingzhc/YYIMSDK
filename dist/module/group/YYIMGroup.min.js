YYIMChat=function(e){var t=e.constructor,r=function(){function t(t){jQuery.ajax({url:e.getConfig().SERVLET.REST_USER_SERVLET+e.getConfig().MULTI_TENANCY.ETP_KEY+"/"+e.getConfig().MULTI_TENANCY.APP_KEY+"/"+e.getUserID()+"/room/contacts/increment?timestamp="+t.startDate+"&token="+e.getToken()+"&membersLimit="+t.membersLimit,type:"get",dataType:"json",cache:!1,success:function(r){if(r){r.roomItems=r.roomItems||[],r.roomNames=r.roomNames||[],r.leftRooms=r.leftRooms||[];for(var o=r.roomItems.length||0;o--;)r.roomItems[o]=p(r.roomItems[o]);for(var n=r.roomNames.length||0;n--;)r.roomNames[n]=e.getJIDUtil().getID(r.roomNames[n]);for(var i=r.leftRooms.length||0;i--;)r.leftRooms[i]=e.getJIDUtil().getID(r.leftRooms[i])}t.success&&t.success(r||{}),t=null},error:function(e){try{t.error&&t.error(JSON.parse(e.responseText)),t=null}catch(e){t.error&&t.error(),t=null}}})}function r(t){var r={start:YYIMCommonUtil.isNumber(t.start)?t.start:0,size:YYIMCommonUtil.isNumber(t.size)?t.size:20,search:t.keyword};e.getConnection().send(new JumpPacket(r,OPCODE.QUERY_CHATGROUP.SEND),function(t,r){for(var o=t.items||[],n=o.length;n--;){var i=o[n];o[n].id=e.getJIDUtil().getID(i.jid),o[n].name=o[n].name||o[n].id}r.complete&&r.complete(),r.success&&r.success({start:t.start,total:t.total,items:o})},t)}function o(t){jQuery.ajax({url:e.getConfig().SERVLET.REST_USER_SERVLET+e.getConfig().MULTI_TENANCY.ETP_KEY+"/"+e.getConfig().MULTI_TENANCY.APP_KEY+"/"+e.getUserID()+"/room/info?membersLimit="+t.membersLimit+"&mucId="+t.jid+"&token="+e.getToken(),type:"get",dataType:"json",cache:!1,success:function(e){var r=p(e);t.success&&t.success(r),t=null},error:function(e){try{t.error&&t.error(JSON.parse(e.responseText)),t=null}catch(e){t.error&&t.error(),t=null}}})}function n(t){var r={id:Math.uuid(),to:t.to,naturalLanguageName:t.name,from:e.getUserBareJID(),invitees:t.members};e.getConnection().send(new JumpPacket(r,OPCODE.CREATE_GROUP.SEND),function(e,t){t.complete&&t.complete(),t.success&&t.success(p(e))},t)}function s(t){var r={id:Math.uuid(),to:t.to,from:e.getUserBareJID(),newOwner:t.newOwner};e.getConnection().send(new JumpPacket(r,OPCODE.TRANSFER_GROUP.SEND),function(e,t){t.complete&&t.complete(),t.success&&t.success(l(e))},t)}function a(t){var r={id:Math.uuid(),to:t.to,from:e.getUserBareJID()};e.getConnection().send(new JumpPacket(r,OPCODE.DISMISS_GROUP.SEND),function(t,r){r.complete&&r.complete(),r.success&&r.success({id:t.id,from:e.getJIDUtil().getID(t.from),to:e.getJIDUtil().getID(t.to)})},t)}function u(t){var r={id:Math.uuid(),to:t.to,from:e.getUserBareJID(),invitees:t.members};e.getConnection().send(new JumpPacket(r,OPCODE.INVITE_GROUP_MEMBER.SEND),function(e,t){t.complete&&t.complete(),t.success&&t.success(p(e))},t)}function c(t){var r={id:Math.uuid(),naturalLanguageName:t.name,from:e.getUserBareJID(),to:t.to};e.getConnection().send(new JumpPacket(r,OPCODE.MODIFY_GROUP_INFO.SEND),function(e,t){t.complete&&t.complete(),t.success&&t.success(p(e))},t)}function m(t){var r={id:Math.uuid(),member:t.member,from:e.getUserBareJID(),to:t.to};e.getConnection().send(new JumpPacket(r,OPCODE.KICK_GROUP_MEMBER.SEND),function(e,t){t.complete&&t.complete(),t.success&&t.success(p(e))},t)}function g(t){var r={id:Math.uuid(),from:e.getUserBareJID(),to:t.to};e.getConnection().send(new JumpPacket(r,OPCODE.EXIT_GROUP.SEND),function(t,r){r.complete&&r.complete(),r.success&&r.success({from:e.getJIDUtil().getID(t.from),id:t.id,to:e.getJIDUtil().getID(t.to)})},t)}function p(t){if(t){for(var r=t.members.length,o=[];r--;){var n=t.members[r];n.id=e.getJIDUtil().getID(n.jid),o.push(n)}return{id:e.getJIDUtil().getID(t.from||t.jid),name:t.naturalLanguageName||t.roomname||t.name,photo:t.photo,numberOfMembers:t.numberOfMembers,superLarge:t.superLarge,collected:t.collected,type:t.type,safeModel:t.safeModel,creationdate:t.creationdate,creater:e.getJIDUtil().getID(t.operator),members:o,owners:t.owners,tag:t.tag}}}function l(t){if(t){for(var r=t.memberItems.length,o=[];r--;){var n=t.memberItems[r];n.id=e.getJIDUtil().getID(n.jid),o.push(n)}return{id:e.getJIDUtil().getID(t.from),members:o}}}function I(t){var r={id:Math.uuid(),from:e.getUserBareJID(),to:t.to,type:t.type};e.getConnection().send(new JumpPacket(r,OPCODE.COLLECT_GROUP.SEND),function(t,r){r.complete&&r.complete(),r.success&&r.success({from:e.getJIDUtil().getID(r.to),id:t.id,to:e.getUserID(),type:r.type,code:t.code,message:t.message})},t)}function f(t){var r=[e.getConstants().CHAT_TYPE.CHAT,e.getConstants().CHAT_TYPE.GROUP_CHAT,e.getConstants().CHAT_TYPE.PUB_ACCOUNT].indexOf(t.type)>-1?t.type:e.getConstants().CHAT_TYPE.CHAT,o=e.getConfig().SERVLET.REST_USER_SERVLET+e.getConfig().MULTI_TENANCY.ETP_KEY+"/"+e.getConfig().MULTI_TENANCY.APP_KEY+"/shareattachment/persional/attachment/"+e.getUserID()+"/"+t.id;r==e.getConstants().CHAT_TYPE.GROUP_CHAT&&(o=e.getConfig().SERVLET.REST_USER_SERVLET+e.getConfig().MULTI_TENANCY.ETP_KEY+"/"+e.getConfig().MULTI_TENANCY.APP_KEY+"/shareattachment/room/attachment/"+t.id+"/"+e.getUserID()),jQuery.ajax({url:o,data:{token:e.getToken(),fileType:["file","image","microvideo"].indexOf(t.fileType)>-1?t.fileType:"file",start:parseInt(t.start)||0,size:parseInt(t.size)||20},type:"get",dataType:"json",cache:!1,success:function(o){var n=o.list||[];for(i=n.length;i--;){var s=n[i];if(s.id=s.packetId,s.creator=e.getJIDUtil().getID(s.creator),s.owner=[],r==e.getConstants().CHAT_TYPE.GROUP_CHAT)s.owner.push({id:e.getJIDUtil().getID(s.ownerId),type:r});else{var a=s.ownerId.split("::");a[0]=e.getJIDUtil().getID(a[0]),a[1]=e.getJIDUtil().getID(a[1]),s.owner.push({id:a[0],type:r},{id:a[1],type:r})}delete s.ownerId}t.success&&t.success(o),t=null},error:function(e){try{t.error&&t.error(JSON.parse(e.responseText)),t=null}catch(e){t.error&&t.error(),t=null}}})}function d(t){jQuery.ajax({url:e.getConfig().SERVLET.REST_USER_SERVLET+e.getConfig().MULTI_TENANCY.ETP_KEY+"/"+e.getConfig().MULTI_TENANCY.APP_KEY+"/"+e.getUserID()+"/room/members?mucId="+t.id+"&token="+e.getToken(),type:"get",dataType:"json",cache:!1,success:function(r){if(r&&r.length)for(var o=r.length;o--;)r[o].id=e.getJIDUtil().getID(r[o].jid);t.success&&t.success(r||[]),t=null},error:function(){try{t.error&&t.error(JSON.parse(xhr.responseText)),t=null}catch(e){t.error&&t.error(),t=null}}})}function C(t){var r={to:t.jid+"/"+e.getUserNode()};e.getConnection().send(new JumpPacket(r,OPCODE.CHATGROUP.SEND),function(t,r){t&&"40301"==t.code?r.error&&r.error({code:t.code,message:t.message}):t&&(t.id=e.getJIDUtil().getID(t.from),r.success&&r.success(t))},t)}function D(){e.getConnection().registerHandler(OPCODE.ON_GROUP_UPDATE.KEY,function(t){var r=p(t);r&&e.onGroupUpdate(r)}),e.getConnection().registerHandler(OPCODE.ON_GROUP_TRANSFER.KEY,function(t){var r=l(t);r&&e.onTransferGroupOwner(r)}),e.getConnection().registerHandler(OPCODE.KICKED_GROUP.KEY,function(t){var r={id:t.id,from:e.getJIDUtil().getID(t.from),to:e.getJIDUtil().getID(t.to)};r&&e.onKickedOutGroup(r)})}return{monitor:D,queryChatGroup:r,getGroupMembers:d,joinChatGroup:C,getChatGroupInfo:o,getChatGroups:t,createChatGroup:n,transferChatGroup:s,dismissChatGroup:a,getSharedFiles:f,inviteGroupMember:u,modifyChatGroupInfo:c,kickGroupMember:m,exitChatGroup:g,collectChatGroup:I}}();return e.setBackhander({monitor:{groupMonitor:r.monitor},initCallback:{group:function(t){e.onGroupUpdate=t.onGroupUpdate||function(){},e.onTransferGroupOwner=t.onTransferGroupOwner||function(){},e.onKickedOutGroup=t.onKickedOutGroup||function(){}}}}),t.prototype.queryChatGroup=function(e){YYIMCommonUtil.isStringAndNotEmpty(e.keyword)?r.queryChatGroup(e):e&&e.error&&e.error()},t.prototype.joinChatGroup=function(t){YYIMCommonUtil.isStringAndNotEmpty(t.id)?r.joinChatGroup({jid:e.getJIDUtil().buildChatGroupJID(e.getJIDUtil().getNode(t.id)),success:t.success,error:t.error}):t&&t.error&&t.error()},t.prototype.getChatGroupInfo=function(t){YYIMCommonUtil.isStringAndNotEmpty(t.id)?r.getChatGroupInfo({jid:e.getJIDUtil().buildChatGroupJID(e.getJIDUtil().getNode(t.id)),membersLimit:YYIMCommonUtil.isNumber(t.membersLimit)&&t.membersLimit>0?t.membersLimit:e.getConfig().GROUP.MEMBERSLIMIT,success:t.success,error:t.error}):t&&t.error&&t.error()},t.prototype.getChatGroups=function(t){t=t||{},t.startDate=YYIMUtil.isWhateType(t.startDate,"Number")&&t.startDate>0?t.startDate:0,t.membersLimit=YYIMCommonUtil.isNumber(t.membersLimit)&&t.membersLimit>0?t.membersLimit:e.getConfig().GROUP.MEMBERSLIMIT,r.getChatGroups(t)},t.prototype.createChatGroup=function(e){YYIMArrayUtil.isArray(e.members)||delete e.members,e.members?r.createChatGroup(e):e&&e.error&&e.error()},t.prototype.transferChatGroup=function(t){t&&"string"==typeof t.newOwner&&t.to?(t.to=e.getJIDUtil().buildChatGroupJID(e.getJIDUtil().getNode(t.to)),r.transferChatGroup(t)):t&&t.error&&t.error()},t.prototype.dismissChatGroup=function(t){t&&t.to?(t.to=e.getJIDUtil().buildChatGroupJID(e.getJIDUtil().getNode(t.to)),r.dismissChatGroup(t)):t&&t.error&&t.error()},t.prototype.getSharedFiles=function(e){e&&e.id?r.getSharedFiles(e):e&&e.error&&e.error()},t.prototype.inviteGroupMember=function(t){t.members&&YYIMArrayUtil.isArray(t.members)&&t.members.length&&t.to?(t.to=e.getJIDUtil().buildChatGroupJID(e.getJIDUtil().getNode(t.to)),r.inviteGroupMember(t)):t&&t.error&&t.error()},t.prototype.modifyChatGroupInfo=function(t){t.name&&t.to?(t.to=e.getJIDUtil().buildChatGroupJID(e.getJIDUtil().getNode(t.to)),r.modifyChatGroupInfo(t)):t&&t.error&&t.error()},t.prototype.kickGroupMember=function(t){t.member&&"string"==typeof t.member&&t.to?(t.to=e.getJIDUtil().buildChatGroupJID(e.getJIDUtil().getNode(t.to)),r.kickGroupMember(t)):t&&t.error&&t.error()},t.prototype.exitChatGroup=function(t){t.to?(t.to=e.getJIDUtil().buildChatGroupJID(e.getJIDUtil().getNode(t.to)),r.exitChatGroup(t)):t&&t.error&&t.error()},t.prototype.collectGroup=function(t){t.to?(t.to=e.getJIDUtil().buildChatGroupJID(e.getJIDUtil().getNode(t.to)),t.type=this.getConstants().COLLECT_TYPE.ADD,r.collectChatGroup(t)):t&&t.error&&t.error()},t.prototype.removeCollectGroup=function(t){t.to?(t.to=e.getJIDUtil().buildChatGroupJID(e.getJIDUtil().getNode(t.to)),t.type=this.getConstants().COLLECT_TYPE.REMOVE,r.collectChatGroup(t)):t&&t.error&&t.error()},t.prototype.getGroupMembers=function(e){var t=e.id||e.to;e&&t?YYIMCommonUtil.isStringAndNotEmpty(t)&&r.getGroupMembers(e):e&&e.error&&e.error()},t.getInstance()}(YYIMChat);