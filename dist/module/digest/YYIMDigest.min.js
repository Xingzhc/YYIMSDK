YYIMChat=function(t){var e=t.constructor,n=function(){function e(e){var n={startDate:e.startDate};e.size&&(n.size=e.size),jQuery.ajax({url:t.getConfig().SERVLET.REST_USER_SERVLET+t.getConfig().MULTI_TENANCY.ETP_KEY+"/"+t.getConfig().MULTI_TENANCY.APP_KEY+"/"+t.getUserID()+"/contactsmessage/digests?token="+t.getToken(),type:"get",data:n,dataType:"json",cache:!1,success:function(n){for(var s in n.list)if(n.list.hasOwnProperty(s)){var a=n.list[s];a.id=t.getJIDUtil().getID(a.jid),a.type=t.getJIDUtil().getChatTypeByJid(a.jid);try{a.lastMessage&&(a.lastMessage=r(JSON.parse(a.lastMessage),a.type))}catch(t){}}e.success&&e.success(n),e=null},error:function(t){try{e.error&&e.error(JSON.parse(t.responseText)),e=null}catch(t){e.error&&e.error(),e=null}}})}function n(e,n){if(e){var r=JSON.parse(e);try{isNaN(Number(r.content))&&n!=t.getConstants().MESSAGE_CONTENT_TYPE.TEXT&&(r.content=JSON.parse(r.content),r.content.content&&(r.content=r.content.content))}catch(t){}return r}return null}function r(e,r){var s={from:t.getJIDUtil().getID(e.sender),to:t.getJIDUtil().getID(e.receiver||t.getUserID()),id:e.packetId,dateline:e.dateline||e.ts,type:r,sessionVersion:e.sessionVersion};if(r&&(r==t.getConstants().CHAT_TYPE.GROUP_CHAT?s.from={room:t.getJIDUtil().getID(e.mucid),roster:t.getJIDUtil().getID(e.sender)}:r==t.getConstants().CHAT_TYPE.PUB_ACCOUNT&&(s.from={room:t.getJIDUtil().getID(e.sender),roster:t.getJIDUtil().getID(t.getJIDUtil().getResource(e.sender))})),e.content){s.data=s.data||{};try{var a=n(e.content,e.contentType);a&&(a.content||""===a.content)?s.data=a:s.data.content=a}catch(t){}if(s.data.contentType=e.contentType,s.data.dateline=e.dateline||e.ts,s.data.content&&s.data.contentType&&(s.data.contentType==t.getConstants().MESSAGE_CONTENT_TYPE.IMAGE||s.data.contentType==t.getConstants().MESSAGE_CONTENT_TYPE.FILE)&&(s.data.content.attachId=s.data.content.path,s.data.content.path=t.getFileUrl(s.data.content.path)),t.getJIDUtil().getID(e.sender)!=t.getUserID()){var o={to:t.getJIDUtil().getID(e.mucid||e.sender),id:s.id,type:s.type,sessionVersion:s.sessionVersion};s.data.receipt=o}}return s}function s(e){var n={chat:"user",groupchat:"room",pubaccount:"pub"};jQuery.ajax({url:t.getConfig().SERVLET.REST_USER_SERVLET+t.getConfig().MULTI_TENANCY.ETP_KEY+"/"+t.getConfig().MULTI_TENANCY.APP_KEY+"/"+t.getUserID()+"/contacts/"+(n[e.type]||n.chat)+"/"+e.id+"?token="+t.getToken(),type:"DELETE",dataType:"json",cache:!1,success:function(t){e.success&&e.success(t),e=null},error:function(t){try{e.error&&e.error(JSON.parse(t.responseText)),e=null}catch(t){e.error&&e.error(),e=null}}})}return{getRecentDigset:e,removeRecentDigest:s}}();return e.prototype.getRecentDigset=function(t){t.startDate=YYIMUtil.isWhateType(t.startDate,"Number")&&t.startDate>0?t.startDate:0,YYIMUtil.isWhateType(t.size,"Number")&&t.size>0||delete t.size,n.getRecentDigset(t)},e.prototype.removeRecentDigest=function(t){t.id?n.removeRecentDigest(t):t&&t.error&&t.error()},e.getInstance()}(YYIMChat);